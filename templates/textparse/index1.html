<style>    
.form {
	font-size: 18px;
}
body {
	margin: 50px;
	margin-top: 80px;
	}
button {
	padding: 8px;
	font-size: 15px;
}

.admin {
/*        position: absolute;
        margin-left: auto;
        margin-right: 30px;
        top: 100;
        right: 0;*/
	margin-top: 20px;
        width: 180px;
        padding: 20px;
        border: none;
        border-radius: 20px;
        font-size: 20px;
        background-color: cornflowerblue;
        color: whitesmoke;
}

.topic{
	font-family: 'Monospace';
	border: solid 1px black;
	border-radius: 5px;
	padding: 15px;
	font-size: 17px;
	width: 70%;
	max-width:700px;
}

.bodytxt {
	font-family: 'Monospace';
        border: solid 1px black;
        border-radius: 5px;
        padding: 15px;
        font-size: 17px;
        width: 70%;
	max-width:700px;
	height: 300px;
	overflow: scroll;
}
.slider {
  margin-top: 30px;
  position: absolute;
  margin-right: 30px;
  margin-left: auto;
  width: 50px;
  height: 50px;
  cursor: pointer;
  background-color: #54c769;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}

.slider:before {
  position: absolute;
  content: "";
  height: 25px;
  width: 25px;
  top: 12px;
  right: 5px;
  left: 12px;
  bottom: 0px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
} 

  
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider.round {
        border-radius: 34px;
}

.slider.round:before {
        border-radius: 50%;
        }

</style>
    <label class = "switch" onClick="update()">
    <span class = "slider round"></span>
    </label>
   
    <div class = "form">
    	{{ final.top }}<br />
	<div class = "topic">{{ final.topic }}</div> <br />
	{{ final.bod }} <br/>
	<div id = "bodytext" class = "bodytxt"></div>
    </div>
    <a href = "/"><button class="admin">Try Again</button></a>
<script>
function update() {
	var text = document.getElementById("bodytext").innerHTML
	var slider = document.getElementsByClassName("slider")[0]	
	if(text == "{{b|safe|escapejs}}")
	{
		window.parser()
		slider.style.background = "#54c769"
	}
	else
	{
		document.getElementById("bodytext").innerHTML = "{{ b|safe|escapejs }}"
		slider.style.background = "salmon"
	}
}

function parser() {
keys = {{ keys|safe }}
console.log(keys)
{% autoescape off %}
    var bodyog = "{{ b|safe|escapejs }}"
    body = bodyog.split("\n")
//    var final = []
//    body.forEach((str) => final = final.concat(str.split(" ")))
//	console.log("{{body|escapejs}}")
{% endautoescape %}
newkeys = new Object;
var k = 0;
for(key in keys) {
	var c = 'key'+k;
	newkeys[c] = key;
	bodyog = bodyog.replace(key, c);
	k++;
}

bodyog = bodyog.split('\n');
document.getElementById("bodytext").innerHTML = "";
bodyog.forEach((s) => {
     	s.split(" ").forEach((str) => {
	var body = document.getElementById("bodytext");
	str = str.replace(/[!"#%&'$()*.;,?]/g, "").trim();
	if(str in newkeys) { 
	var button = document.createElement("button");
	t =keys[newkeys[str]];
	button.innerHTML = t;
	body.appendChild(button);
	let x = new SpeechSynthesisUtterance(newkeys[str]);
	button.addEventListener("click", () => speechSynthesis.speak(x));
	}
	else { 	
	t = document.createTextNode(str);		
	body.appendChild(t);
	}
	space = document.createTextNode(" ");
	body.appendChild(space);
	})
	var body = document.getElementById("bodytext");
	body.appendChild(document.createElement("br"));
	})
}

window.parser()
</script>
